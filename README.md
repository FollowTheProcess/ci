# CI

[![License](https://img.shields.io/github/license/FollowTheProcess/ci)](https://github.com/FollowTheProcess/ci)
[![GitHub](https://img.shields.io/github/v/release/FollowTheProcess/ci?logo=github&sort=semver)](https://github.com/FollowTheProcess/ci)

Consistent, high quality, and configurable CI for various languages and ecosystems üõ†Ô∏è

- [CI](#ci)
  - [Go](#go)
    - [Inputs](#inputs)
    - [Usage](#usage)
    - [Permissions](#permissions)
  - [Rust](#rust)
    - [Inputs](#inputs-1)
    - [Usage](#usage-1)
    - [Permissions](#permissions-1)

## Go

A great drop in CI pipeline for Go projects!

- Run tests with `go test` on linux, macos, and windows with the option to pass in additional flags as desired
- Race detector on by default
- Go version automatically detected from `go.mod`
- Uses [tparse] to output a nice test summary to `$GITHUB_STEP_SUMMARY` (with an option to disable)
- Optionally upload coverage reports to [CodeCov.io] (with tokenless upload)
- Linting with [golangci-lint] via the [golangci-lint-action], driven from your local `.golangci-lint.yml` config
- Check for typos with [typos-cli]
- Vulnerability analysis with [govulncheck]
- Automatically discover and run fuzz tests in a matrix with a configurable fuzz time

<!-- Docs below generated by action-docs -->

<!-- action-docs-all source=".github/workflows/Go.yml" project="FollowTheProcess/ci/.github/workflows/Go.yml" version="v1" -->
### Inputs

| name                    | description                                                                                                                                                                                                                                                                                                                           | type      | required | default  |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | -------- | -------- |
| `test-summary`          | <p>Use https://github.com/mfridman/tparse to summarise test output to <code>GITHUB_STEP_SUMMARY</code></p>                                                                                                                                                                                                                            | `boolean` | `false`  | `true`   |
| `test-flags`            | <p>Additional flags to pass to <code>go test</code>. <code>-race</code>, <code>-cover</code> and <code>-covermode</code> are all already set. If <code>test-summary</code> is true, then the <code>-json</code> flag will be automatically set as well. But here you may pass <code>-v</code> for example or any other test flag.</p> | `string`  | `false`  | `""`     |
| `fuzz`                  | <p>Automatically generate a matrix of fuzz tests and run them in parallel for a configurable <code>fuzz-time</code>. If there are no fuzz tests in the project, this is a no op so is a safe option to leave on.</p>                                                                                                                  | `boolean` | `false`  | `true`   |
| `fuzz-time`             | <p>Time (in Go <code>time.Duration</code> format) to run each fuzz test for</p>                                                                                                                                                                                                                                                       | `string`  | `false`  | `1m`     |
| `codecov`               | <p>Send coverage data to CodeCov.io. Requires that tokenless uploading has been configured and is enabled.</p>                                                                                                                                                                                                                        | `boolean` | `false`  | `true`   |
| `golangci-lint-version` | <p>The version of golangci-lint to use</p>                                                                                                                                                                                                                                                                                            | `string`  | `false`  | `latest` |
| `timeout-minutes`       | <p>Maximum number of minutes to let each step execute for, will be cancelled when timeout is met.</p>                                                                                                                                                                                                                                 | `number`  | `false`  | `15`     |
| `working-directory`     | <p>The working directory to be in for the entire workflow</p>                                                                                                                                                                                                                                                                         | `string`  | `false`  | `.`      |

### Usage

```yaml
jobs:
  job1:
    uses: FollowTheProcess/ci/.github/workflows/Go.yml@v1
    with:
      test-summary:
      # Use https://github.com/mfridman/tparse to summarise test output to `GITHUB_STEP_SUMMARY`
      #
      # Type: boolean
      # Required: false
      # Default: true

      test-flags:
      # Additional flags to pass to `go test`. `-race`, `-cover` and `-covermode` are all already set. If `test-summary` is true, then the `-json` flag will be automatically set as well. But here you may pass `-v` for example or any other test flag.
      #
      # Type: string
      # Required: false
      # Default: ""

      fuzz:
      # Automatically generate a matrix of fuzz tests and run them in parallel for a configurable `fuzz-time`. If there are no fuzz tests in the project, this is a no op so is a safe option to leave on.
      #
      # Type: boolean
      # Required: false
      # Default: true

      fuzz-time:
      # Time (in Go `time.Duration` format) to run each fuzz test for
      #
      # Type: string
      # Required: false
      # Default: 1m

      codecov:
      # Send coverage data to CodeCov.io. Requires that tokenless uploading has been configured and is enabled.
      #
      # Type: boolean
      # Required: false
      # Default: true

      golangci-lint-version:
      # The version of golangci-lint to use
      #
      # Type: string
      # Required: false
      # Default: latest

      timeout-minutes:
      # Maximum number of minutes to let each step execute for, will be cancelled when timeout is met.
      #
      # Type: number
      # Required: false
      # Default: 15

      working-directory:
      # The working directory to be in for the entire workflow
      #
      # Type: string
      # Required: false
      # Default: .
```
<!-- action-docs-all source=".github/workflows/Go.yml" project="FollowTheProcess/ci/.github/workflows/Go.yml" version="v1" -->

### Permissions

<!-- Detail the permissions that it needs here -->

This workflow needs the following permissions when invoked:

```yaml
contents: read # For checking out your code
```

## Rust

Rust CI can get complex, but this is a great simple CI flow for most crates

- Tests run on all 3 major OS's (ubuntu, macos, windows)
- Configurable rust [toolchain] via [rustup]
- Optionally use [nextest] as the test runner
- Dependency caching
- Linting with [clippy] and format checks with rustfmt
- Check for typos with [typos-cli]

<!-- Docs below generated by action-docs -->

<!-- action-docs-all source=".github/workflows/Rust.yml" project="FollowTheProcess/ci/.github/workflows/Rust.yml" version="v1" -->
### Inputs

| name                | description                                                                                                                                                                                                      | type      | required | default                        |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | -------- | ------------------------------ |
| `toolchain`         | <p>The rust toolchain to install e.g "stable", "nightly" etc. any rustup toolchain expression is supported, see https://rust-lang.github.io/rustup/concepts/toolchains.html</p>                                  | `string`  | `false`  | `stable`                       |
| `nextest`           | <p>Use <code>cargo nextest</code> as the test runner, instead of <code>cargo test</code>. If true, doctests will be run as a separate step with <code>cargo test</code> as nextest does not yet support them</p> | `boolean` | `false`  | `false`                        |
| `nextest-profile`   | <p>Name of the nextest profile to use for <code>cargo nextest</code>. Only has any effect if using nextest as the test runner</p>                                                                                | `string`  | `false`  | `default`                      |
| `rustflags`         | <p>Value of the <code>RUSTFLAGS</code> env var</p>                                                                                                                                                               | `string`  | `false`  | `--deny warnings`              |
| `test-flags`        | <p>Command line flags to pass to <code>cargo test</code> (or <code>cargo nextest run</code> if using nextest). <code>--locked</code> is used regardless.</p>                                                     | `string`  | `false`  | `--all-targets --all-features` |
| `timeout-minutes`   | <p>Maximum number of minutes to let each step execute for, will be cancelled when timeout is met.</p>                                                                                                            | `number`  | `false`  | `15`                           |
| `working-directory` | <p>The working directory to be in for the entire workflow</p>                                                                                                                                                    | `string`  | `false`  | `.`                            |

### Usage

```yaml
jobs:
  job1:
    uses: FollowTheProcess/ci/.github/workflows/Rust.yml@v1
    with:
      toolchain:
      # The rust toolchain to install e.g "stable", "nightly" etc. any rustup toolchain expression is supported, see https://rust-lang.github.io/rustup/concepts/toolchains.html
      #
      # Type: string
      # Required: false
      # Default: stable

      nextest:
      # Use `cargo nextest` as the test runner, instead of `cargo test`. If true, doctests will be run as a separate step with `cargo test` as nextest does not yet support them
      #
      # Type: boolean
      # Required: false
      # Default: false

      nextest-profile:
      # Name of the nextest profile to use for `cargo nextest`. Only has any effect if using nextest as the test runner
      #
      # Type: string
      # Required: false
      # Default: default

      rustflags:
      # Value of the `RUSTFLAGS` env var
      #
      # Type: string
      # Required: false
      # Default: --deny warnings

      test-flags:
      # Command line flags to pass to `cargo test` (or `cargo nextest run` if using nextest). `--locked` is used regardless.
      #
      # Type: string
      # Required: false
      # Default: --all-targets --all-features

      timeout-minutes:
      # Maximum number of minutes to let each step execute for, will be cancelled when timeout is met.
      #
      # Type: number
      # Required: false
      # Default: 15

      working-directory:
      # The working directory to be in for the entire workflow
      #
      # Type: string
      # Required: false
      # Default: .
```
<!-- action-docs-all source=".github/workflows/Rust.yml" project="FollowTheProcess/ci/.github/workflows/Rust.yml" version="v1" -->

### Permissions

<!-- Detail the permissions that it needs here -->

This workflow needs the following permissions when invoked:

```yaml
contents: read # For checking out your code
```

[tparse]: https://github.com/mfridman/tparse
[CodeCov.io]: https://about.codecov.io/
[golangci-lint]: https://golangci-lint.run/
[golangci-lint-action]: https://github.com/golangci/golangci-lint-action
[govulncheck]: https://go.dev/blog/vuln
[typos-cli]: https://github.com/crate-ci/typos
[toolchain]: https://rust-lang.github.io/rustup/concepts/toolchains.html
[rustup]: https://github.com/rust-lang/rustup
[clippy]: https://doc.rust-lang.org/clippy/
[nextest]: https://nexte.st/
